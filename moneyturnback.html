<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚µå‹™ç²‰ç¢æ©Ÿ v4.0 - æˆ°ç•¥ç‰ˆ</title>
    <style>
        body { font-family: "Segoe UI", "Microsoft JhengHei", sans-serif; background: #f0f4f8; display: flex; justify-content: center; padding: 20px; color: #333; margin: 0; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px rgba(50,50,93,0.1), 0 5px 15px rgba(0,0,0,0.07); max-width: 850px; width: 100%; }
        
        h2 { text-align: center; color: #1a365d; margin-bottom: 10px; font-weight: 800; letter-spacing: -0.5px; }
        .subtitle { text-align: center; color: #718096; font-size: 14px; margin-bottom: 30px; }

        /* åˆ†çµ„æ¨™é¡Œ */
        .group-header { display: flex; align-items: center; margin-bottom: 15px; margin-top: 25px; }
        .group-icon { background: #3182ce; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px; font-size: 14px; }
        .group-title { font-weight: 700; color: #2d3748; font-size: 18px; }

        /* è¼¸å…¥ç¶²æ ¼ */
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; }
        .form-group { background: #f7fafc; padding: 15px; border-radius: 12px; border: 1px solid #edf2f7; transition: 0.2s; }
        .form-group:focus-within { border-color: #3182ce; background: #fff; box-shadow: 0 0 0 3px rgba(49,130,206,0.1); }
        
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #4a5568; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; }
        input { width: 100%; padding: 8px 0; border: none; background: transparent; border-bottom: 2px solid #cbd5e0; font-size: 18px; color: #2d3748; font-weight: 600; outline: none; border-radius: 0; transition: 0.2s; }
        input:focus { border-bottom-color: #3182ce; }
        input::placeholder { color: #a0aec0; font-weight: 400; }

        /* ç­–ç•¥å€å¡Š (ä¸åŒçš„é¡è‰²) */
        .strategy-section .form-group { background: #fffaf0; border-color: #feebc8; }
        .strategy-section .form-group:focus-within { border-color: #dd6b20; box-shadow: 0 0 0 3px rgba(221,107,32,0.1); }
        
        /* æŒ‰éˆ• */
        .btn-calc { width: 100%; padding: 16px; background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 30px; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 6px rgba(50,50,93,0.11); }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 7px 14px rgba(50,50,93,0.1); }

        /* çµæœå±•ç¤º */
        .result-panel { display: none; margin-top: 40px; animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        
        /* å„€è¡¨æ¿å¡ç‰‡ */
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .dash-card { background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; text-align: center; }
        .dash-card.highlight { background: #ebf8ff; border-color: #bee3f8; }
        .dash-val { font-size: 24px; font-weight: 800; color: #2d3748; margin-top: 5px; }
        .dash-label { font-size: 13px; color: #718096; font-weight: 600; }
        .saved-badge { color: #38a169; font-size: 14px; font-weight: bold; margin-top: 5px; display: block; }

        /* é‡Œç¨‹ç¢‘ */
        .milestones { background: white; border-radius: 12px; padding: 25px; border: 1px solid #e2e8f0; margin-bottom: 30px; position: relative; overflow: hidden; }
        .milestones h3 { margin-top: 0; color: #2d3748; font-size: 16px; border-bottom: 2px solid #edf2f7; padding-bottom: 10px; margin-bottom: 20px; }
        .timeline-item { display: flex; justify-content: space-between; margin-bottom: 15px; position: relative; padding-left: 20px; }
        .timeline-item::before { content: ''; position: absolute; left: 0; top: 6px; width: 10px; height: 10px; border-radius: 50%; background: #cbd5e0; }
        .timeline-item.reached::before { background: #38a169; box-shadow: 0 0 0 3px #c6f6d5; }
        .m-date { font-weight: bold; color: #2d3748; }
        .m-desc { color: #4a5568; }

        /* è¡¨æ ¼ */
        .table-container { overflow-x: auto; border-radius: 12px; border: 1px solid #e2e8f0; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; font-size: 14px; }
        th { background: #f7fafc; text-align: left; padding: 12px 15px; color: #4a5568; font-weight: 700; border-bottom: 1px solid #e2e8f0; }
        td { padding: 12px 15px; border-bottom: 1px solid #edf2f7; color: #2d3748; }
        tr:last-child td { border-bottom: none; }
        .increase-row { background-color: #ebf8ff; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ”¨ å‚µå‹™ç²‰ç¢æ©Ÿ v4.0</h2>
    <div class="subtitle">æˆ°ç•¥åˆ†æ | è¡Œç‚ºæ¿€å‹µ | é‡Œç¨‹ç¢‘é æ¸¬</div>

    <div class="group-header">
        <div class="group-icon">1</div>
        <div class="group-title">åŸºç¤å‚µå‹™ç‹€æ³</div>
    </div>
    <div class="input-grid">
        <div class="form-group">
            <label>ç¸½æ¬ æ¬¾ (HKD)</label>
            <input type="number" id="totalDebt" placeholder="ä¾‹å¦‚ï¼š500000">
        </div>
        <div class="form-group">
            <label>éŠ€è¡Œå¹´åˆ©ç‡ (%)</label>
            <input type="number" id="interestRate" placeholder="ä¾‹å¦‚ï¼š5.5" step="0.01">
        </div>
        <div class="form-group">
            <label>ç›®å‰æ¯æœˆé‚„æ¬¾ (HKD)</label>
            <input type="number" id="monthlyPayment" placeholder="ä¾‹å¦‚ï¼š13000">
        </div>
    </div>

    <div class="group-header">
        <div class="group-icon" style="background: #dd6b20;">2</div>
        <div class="group-title">åŠ é€Ÿé‚„æ¬¾ç­–ç•¥ (å¯é¸)</div>
    </div>
    <div class="input-grid strategy-section">
        <div class="form-group">
            <label>â˜• æ—¥å¸¸çœéŒ¢è½‰åŒ– (æ¯æ—¥/HKD)</label>
            <input type="number" id="dailySave" placeholder="0">
            <div style="font-size:11px; color:#718096; margin-top:4px;">å°‘å–æ¯å‡é£²æˆ–å°‘æŠ½åŒ…ç…™ï¼Œç³»çµ±æœƒè‡ªå‹•åŠ åˆ°æ¯æœˆé‚„æ¬¾ä¸­ã€‚</div>
        </div>
        <div class="form-group">
            <label>ğŸ“ˆ æ¯å¹´éå¢é‚„æ¬¾ ($)</label>
            <input type="number" id="yearlyIncrease" placeholder="0">
            <div style="font-size:11px; color:#718096; margin-top:4px;">å‡è¨­æ¯å¹´äººå·¥åŠ è–ªï¼Œä½ é¡˜æ„æ¯å¹´å¤šæ’¥å¤šå°‘éŒ¢ä¾†é‚„å‚µï¼Ÿ(å¦‚: æ¯å¹´åŠ $500)</div>
        </div>
    </div>

    <button class="btn-calc" onclick="crushDebt()">å•Ÿå‹•åˆ†æ</button>

    <div id="resultPanel" class="result-panel">
        
        <div class="dashboard">
            <div class="dash-card">
                <div class="dash-label">é è¨ˆé‚„æ¸…æ™‚é–“</div>
                <div class="dash-val" id="resTime">--</div>
            </div>
            <div class="dash-card highlight">
                <div class="dash-label">ç¸½åˆ©æ¯æ”¯å‡º</div>
                <div class="dash-val" style="color: #e53e3e;" id="resInterest">--</div>
            </div>
            <div class="dash-card" style="border-color: #48bb78; background: #f0fff4;">
                <div class="dash-label">ç­–ç•¥å¸¶ä¾†çš„ç¯€çœ</div>
                <div class="dash-val" style="color: #2f855a;" id="resSaved">--</div>
                <span class="saved-badge" id="resSavedTime">ææ—© -- å€‹æœˆ</span>
            </div>
        </div>

        <div class="milestones">
            <h3>ğŸ† é‚„å‚µå‹åˆ©é‡Œç¨‹ç¢‘</h3>
            <div id="milestoneList">
                </div>
        </div>

        <div class="table-container">
            <table id="detailTable">
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>å¯¦éš›é‚„æ¬¾</th>
                        <th>æœ¬é‡‘</th>
                        <th>åˆ©æ¯</th>
                        <th>å‰©é¤˜æ¬ æ¬¾</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // é è¼‰æ•¸æ“š
    window.onload = function() {
        ['totalDebt', 'interestRate', 'monthlyPayment', 'dailySave', 'yearlyIncrease'].forEach(id => {
            if(localStorage.getItem(id)) document.getElementById(id).value = localStorage.getItem(id);
        });
    }

    function crushDebt() {
        // 1. ç²å–æ•¸æ“š
        let principal = parseFloat(document.getElementById('totalDebt').value);
        let rate = parseFloat(document.getElementById('interestRate').value);
        let basePayment = parseFloat(document.getElementById('monthlyPayment').value);
        let dailySave = parseFloat(document.getElementById('dailySave').value) || 0;
        let yearlyIncrease = parseFloat(document.getElementById('yearlyIncrease').value) || 0;

        // é©—è­‰
        if (!principal || !rate || !basePayment) {
            alert("è«‹å¡«å¯«å®Œæ•´çš„åŸºç¤è³‡æ–™ï¼");
            return;
        }

        // å„²å­˜æ•¸æ“š
        localStorage.setItem('totalDebt', principal);
        localStorage.setItem('interestRate', rate);
        localStorage.setItem('monthlyPayment', basePayment);
        localStorage.setItem('dailySave', dailySave);
        localStorage.setItem('yearlyIncrease', yearlyIncrease);

        // 2. è¨ˆç®—ã€Œç„¡ç­–ç•¥ã€çš„åŸå§‹æƒ…æ³ (ä½œç‚ºå°æ¯”)
        let baseScenario = calculateScenario(principal, rate, basePayment, 0, 0);

        // 3. è¨ˆç®—ã€Œæœ‰ç­–ç•¥ã€çš„åŠ é€Ÿæƒ…æ³
        // æ¯æ—¥çœéŒ¢ x 30å¤© = æ¯æœˆé¡å¤–é‚„æ¬¾
        let monthlyExtra = dailySave * 30; 
        let totalStartPayment = basePayment + monthlyExtra;
        
        let strategyScenario = calculateScenario(principal, rate, totalStartPayment, yearlyIncrease, monthlyExtra);

        if (!strategyScenario.success) {
            alert("ç›®å‰çš„é‚„æ¬¾é¡ä¸è¶³ä»¥æ”¯ä»˜åˆ©æ¯ï¼Œè«‹å¢åŠ é‚„æ¬¾é‡‘é¡ï¼");
            return;
        }

        // 4. æ¸²æŸ“çµæœ
        renderResults(baseScenario, strategyScenario, principal);
    }

    function calculateScenario(principal, rate, startPayment, yearlyIncrease, monthlyExtraBase) {
        let monthlyRate = rate / 100 / 12;
        let balance = principal;
        let totalInterest = 0;
        let months = 0;
        let schedule = [];
        let currentPayment = startPayment;
        
        // æª¢æŸ¥ç¬¬ä¸€å€‹æœˆæ˜¯å¦é‚„å¾—èµ·
        if (balance * monthlyRate >= currentPayment) {
            return { success: false };
        }

        while (balance > 0 && months < 600) { // 50å¹´ä¸Šé™
            months++;
            
            // æ¯å¹´èª¿æ•´é‚„æ¬¾é¡ (æ¯12å€‹æœˆå¢åŠ ä¸€æ¬¡)
            // æ³¨æ„ï¼šç¬¬ä¸€æ¬¡èª¿æ•´æ˜¯åœ¨ç¬¬13å€‹æœˆ
            if (months > 1 && (months - 1) % 12 === 0) {
                currentPayment += yearlyIncrease;
            }

            let interest = balance * monthlyRate;
            let principalPaid = currentPayment - interest;
            
            if (balance < principalPaid) {
                principalPaid = balance;
                currentPayment = balance + interest;
            }

            balance -= principalPaid;
            totalInterest += interest;
            if (balance < 0.01) balance = 0;

            schedule.push({
                month: months,
                payment: currentPayment,
                interest: interest,
                principal: principalPaid,
                balance: balance,
                isIncreaseMonth: (months > 1 && (months - 1) % 12 === 0 && yearlyIncrease > 0)
            });
        }

        return {
            success: true,
            months: months,
            totalInterest: totalInterest,
            schedule: schedule,
            finalPayment: currentPayment // è¨˜éŒ„æœ€å¾Œçš„é‚„æ¬¾èƒ½åŠ›
        };
    }

    function renderResults(base, strategy, startPrincipal) {
        let panel = document.getElementById('resultPanel');
        panel.style.display = 'block';

        // 1. å„€è¡¨æ¿æ•¸æ“š
        let years = Math.floor(strategy.months / 12);
        let m = strategy.months % 12;
        document.getElementById('resTime').innerText = `${years}å¹´ ${m}å€‹æœˆ`;
        document.getElementById('resInterest').innerText = `$${strategy.totalInterest.toFixed(0)}`;

        // è¨ˆç®—ç¯€çœ (å¦‚æœç„¡è§£ï¼Œbaseå¯èƒ½ç‚ºnullæˆ–ç„¡é™ï¼Œé€™è£¡åšç°¡å–®è™•ç†)
        let savedMoney = 0;
        let savedTime = 0;
        
        if (base.success) {
            savedMoney = base.totalInterest - strategy.totalInterest;
            savedTime = base.months - strategy.months;
        }

        // é¡¯ç¤ºç¯€çœæ•¸æ“š
        let savedEl = document.getElementById('resSaved');
        let savedTimeEl = document.getElementById('resSavedTime');
        
        if (savedMoney > 100) {
            savedEl.innerText = `$${savedMoney.toFixed(0)}`;
            savedTimeEl.innerText = `ææ—© ${savedTime} å€‹æœˆè‡ªç”±ï¼`;
            savedEl.parentElement.style.display = 'block';
        } else {
            savedEl.innerText = "ç„¡ç­–ç•¥å·®ç•°";
            savedTimeEl.innerText = "è©¦è©¦è¼¸å…¥çœéŒ¢é‡‘é¡";
            savedEl.parentElement.style.display = 'none'; // å¦‚æœæ²’çœéŒ¢å°±ä¸é¡¯ç¤ºç¶ å¡
        }

        // 2. ç”Ÿæˆé‡Œç¨‹ç¢‘ (75%, 50%, 25%, 0%)
        let milestonesDiv = document.getElementById('milestoneList');
        milestonesDiv.innerHTML = "";
        
        let targets = [
            { pct: 0.75, label: "ğŸ’ª å¥½çš„é–‹å§‹ï¼šæ¬ æ¬¾å‰©é¤˜ 75%" },
            { pct: 0.50, label: "ğŸ”ï¸ æ”»é ‚éåŠï¼šæ¬ æ¬¾å‰©é¤˜ 50%" },
            { pct: 0.25, label: "ğŸš€ æœ€å¾Œè¡åˆºï¼šæ¬ æ¬¾å‰©é¤˜ 25%" },
            { pct: 0.00, label: "ğŸ‰ è²¡å‹™è‡ªç”±ï¼šç„¡å‚µä¸€èº«è¼•ï¼" }
        ];

        let currentTargetIndex = 0;
        let today = new Date();

        strategy.schedule.forEach(row => {
            if (currentTargetIndex < targets.length) {
                let targetAmount = startPrincipal * targets[currentTargetIndex].pct;
                if (row.balance <= targetAmount) {
                    // é”åˆ°ç›®æ¨™
                    let date = new Date(today.getFullYear(), today.getMonth() + row.month, 1);
                    let dateStr = `${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ`;
                    
                    let item = `
                        <div class="timeline-item ${targets[currentTargetIndex].pct === 0 ? 'reached' : ''}">
                            <div class="m-desc">${targets[currentTargetIndex].label}</div>
                            <div class="m-date">${dateStr}</div>
                        </div>
                    `;
                    milestonesDiv.innerHTML += item;
                    currentTargetIndex++;
                }
            }
        });

        // 3. ç”Ÿæˆè¡¨æ ¼ (åªé¡¯ç¤ºå‰ 24 å€‹æœˆ + æ¯å¹´è®ŠåŒ–çš„æœˆä»½ï¼Œé¿å…è¡¨æ ¼éé•·)
        let tbody = document.querySelector("#detailTable tbody");
        tbody.innerHTML = "";
        
        strategy.schedule.forEach((row, index) => {
            // é¡¯ç¤ºé‚è¼¯ï¼šå‰12å€‹æœˆéƒ½é¡¯ç¤ºï¼Œä¹‹å¾Œåªé¡¯ç¤ºæ¯å¹´çš„ç¬¬1å€‹æœˆ(æœ‰è®ŠåŒ–çš„æ™‚å€™)ï¼Œæˆ–è€…æ˜¯æœ€å¾Œä¸€å€‹æœˆ
            let showRow = index < 12 || row.isIncreaseMonth || index === strategy.schedule.length - 1;

            if (showRow) {
                let date = new Date(today.getFullYear(), today.getMonth() + row.month, 1);
                let dateStr = `${date.getFullYear()}/${date.getMonth()+1}`;
                
                let tr = document.createElement('tr');
                if (row.isIncreaseMonth) tr.classList.add('increase-row');
                
                tr.innerHTML = `
                    <td>${dateStr} <span style="font-size:10px; color:#718096">(${row.month}æœŸ)</span></td>
                    <td style="font-weight:bold">$${row.payment.toFixed(0)}</td>
                    <td style="color:#17a2b8">$${row.principal.toFixed(0)}</td>
                    <td style="color:#e53e3e">$${row.interest.toFixed(0)}</td>
                    <td>$${row.balance.toFixed(0)}</td>
                `;
                tbody.appendChild(tr);
                
                // å¦‚æœä¸­é–“æœ‰è·³éï¼ŒåŠ ä¸€è¡Œçœç•¥è™Ÿ
                if (index < strategy.schedule.length - 1 && !strategy.schedule[index+1].isIncreaseMonth && index+1 >= 12) {
                   // ç°¡å–®è™•ç†ï¼Œä¸é¡¯ç¤ºçœç•¥è™Ÿä»¥å…è¤‡é›œï¼Œç›´æ¥è·³é
                }
            }
        });
    }
</script>

</body>
</html>
